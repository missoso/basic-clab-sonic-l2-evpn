!
frr version 10.3
frr defaults traditional
hostname leaf1
no ipv6 forwarding
service integrated-vtysh-config
!
ip prefix-list ALL-ROUTES seq 5 permit 0.0.0.0/0 le 32
ip prefix-list ONLY-ONE-ROUTE seq 5 permit 10.0.1.1/32
ip prefix-list ONLY-ONE-ROUTE seq 100 deny 0.0.0.0/0 le 32
!
route-map EXPORT-ONLY permit 10
 match ip address prefix-list ONLY-ONE-ROUTE
exit
!
route-map EXPORT-ONLY deny 100
exit
!
route-map IMPORT-ONLY permit 10
 match ip address prefix-list ALL-ROUTES
exit
!
interface eth2
 description to_spine
 ip address 192.168.11.0/31
exit
!
interface lo
 ip address 10.0.1.1/32
exit
!
router bgp 101
 bgp router-id 10.0.1.1
 neighbor 10.0.2.1 remote-as 100
 neighbor 10.0.2.1 local-as 100
 neighbor 10.0.2.1 update-source 10.0.1.1
 neighbor 192.168.11.1 remote-as 201
 neighbor 192.168.11.1 update-source 192.168.11.0
 !
 address-family ipv4 unicast
  network 10.0.1.1/32
  network 10.0.11.0/31
  neighbor 192.168.11.1 route-map IMPORT-ONLY in
  neighbor 192.168.11.1 route-map EXPORT-ONLY out
 exit-address-family
 !
 address-family l2vpn evpn
  neighbor 10.0.2.1 activate
  advertise-all-vni
  vni 100
   rd 10.0.1.1:100
   route-target import 65000:100
   route-target export 65000:100
  exit-vni
  advertise-svi-ip
 exit-address-family
exit
!
ip nht resolve-via-default
!
ipv6 nht resolve-via-default
!
end